
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Smooth Rotatable Images with CSS3 and jQuery | Demo | Elated.com</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >

<style type="text/css">

.ui-page {
  background: #000 !important;
}

/* The light table itself */
#lighttable {
  position: relative;
  width: 776px;
  margin: 0 auto;
  height: 380px;
  overflow: hidden;
}

/* Photos on the light table */
#lighttable img {
  position: absolute;
  left: 99px;
  top: 99px;
  overflow: hidden;
}

#lighttable a { 
  height: 75px;
  width: 776px;
  display: block;
  margin-top: 1px;
  text-indent: -2000px;
  position: relative;
}

.centro {
  background: url(img/triangulo-centro.png) no-repeat;
  position: absolute;
  width: 354px;
  height: 404px;
  left: 202px;
}

</style>

<script src="js/jquery-2.0.2.min.js"></script>
<script type="text/javascript" src="js/jquery.mobile-1.3.1.min.js"></script>
<link type="text/css" media="screen" rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css" />

<script type="text/javascript">

var rotateAngle = 0;            // The return for verification
var imageBeingRotated = false;  // The DOM image currently being rotated (if any)
var mouseStartAngle = false;    // The angle of the mouse relative to the image centre at the start of the rotation
var imageStartAngle = false;    // The rotation angle of the image at the start of the rotation

var img01 = 0;
var img02 = 0;
var img03 = 0;
var img04 = 0;
var img05 = 0;

function fix_position(elemento, current_rotation){
    if((current_rotation > 0) && (current_rotation <= 1)){
      elemento.css({
        'transform': 'rotate(' + 90 + 'deg)',
        '-moz-transform': 'rotate(' + 90 + 'deg)',
        '-webkit-transform': 'rotate(' + 90 + 'deg)',
        '-o-transform': 'rotate(' + 90 + 'deg)'
      });
      elemento.data('currentRotation', 90 * Math.PI / 180 );
    }
    else if((current_rotation > 1) && (current_rotation <= 2)){
      elemento.css({
        'transform': 'rotate(' + 135 + 'deg)',
        '-moz-transform': 'rotate(' + 135 + 'deg)',
        '-webkit-transform': 'rotate(' + 135 + 'deg)',
        '-o-transform': 'rotate(' + 135 + 'deg)'
      });
      elemento.data('currentRotation', 135 * Math.PI / 180 );
    }
    else if((current_rotation > 2) && (current_rotation <= 3)){
      elemento.css({
        'transform': 'rotate(' + 180 + 'deg)',
        '-moz-transform': 'rotate(' + 180 + 'deg)',
        '-webkit-transform': 'rotate(' + 180 + 'deg)',
        '-o-transform': 'rotate(' + 180 + 'deg)'
      });
      elemento.data('currentRotation', 180 * Math.PI / 180 );
    }
    else if((current_rotation > 3) && (current_rotation <= 4)){
      elemento.css({
        'transform': 'rotate(' + 225 + 'deg)',
        '-moz-transform': 'rotate(' + 225 + 'deg)',
        '-webkit-transform': 'rotate(' + 225 + 'deg)',
        '-o-transform': 'rotate(' + 225 + 'deg)'
      });
      elemento.data('currentRotation', 225 * Math.PI / 180 );
    }
    else if((current_rotation > 4) && (current_rotation <= 5)){
      elemento.css({
        'transform': 'rotate(' + 270 + 'deg)',
        '-moz-transform': 'rotate(' + 270 + 'deg)',
        '-webkit-transform': 'rotate(' + 270 + 'deg)',
        '-o-transform': 'rotate(' + 270 + 'deg)'
      });
      elemento.data('currentRotation', 270 * Math.PI / 180 );
    }
    else if((current_rotation > 5) && (current_rotation <= 6)){
      elemento.css({
        'transform': 'rotate(' + 315 + 'deg)',
        '-moz-transform': 'rotate(' + 315 + 'deg)',
        '-webkit-transform': 'rotate(' + 315 + 'deg)',
        '-o-transform': 'rotate(' + 315 + 'deg)'
      });
      elemento.data('currentRotation', 315 * Math.PI / 180 );
    }
    else if((current_rotation > 6) && (current_rotation <= 7)){
      elemento.css({
        'transform': 'rotate(' + 360 + 'deg)',
        '-moz-transform': 'rotate(' + 360 + 'deg)',
        '-webkit-transform': 'rotate(' + 360 + 'deg)',
        '-o-transform': 'rotate(' + 360 + 'deg)'
      });
      elemento.data('currentRotation', 360 * Math.PI / 180 );
    }
    else if((current_rotation > 7) && (current_rotation <= 8)){
      elemento.css({
        'transform': 'rotate(' + 405 + 'deg)',
        '-moz-transform': 'rotate(' + 405 + 'deg)',
        '-webkit-transform': 'rotate(' + 405 + 'deg)',
        '-o-transform': 'rotate(' + 405 + 'deg)'
      });
      elemento.data('currentRotation', 405 * Math.PI / 180 );
    }
    else {
      elemento.css({
        'transform': 'rotate(' + 45 + 'deg)',
        '-moz-transform': 'rotate(' + 45 + 'deg)',
        '-webkit-transform': 'rotate(' + 45 + 'deg)',
        '-o-transform': 'rotate(' + 45 + 'deg)'
      });
      elemento.data('currentRotation', 45 * Math.PI / 180 );
    }
  }

$(document).ready(function() {

  $('#lighttable img').each( function(index) {

    // Set a random position and angle for this photo
    var left = Math.floor( index * 76 );
    var top = Math.floor( index * 76 );
    var angle = Math.floor((Math.random() * 300) + 120); //alterar com rand aqui para embaralhar
    $(this).css( 'left', left+'px' );
    $(this).css( 'top', top+'px' );
    $(this).css( 'transform', 'rotate(' + angle + 'deg)' );   
    $(this).css( '-moz-transform', 'rotate(' + angle + 'deg)' );   
    $(this).css( '-webkit-transform', 'rotate(' + angle + 'deg)' );
    $(this).css( '-o-transform', 'rotate(' + angle + 'deg)' );
    $(this).data('currentRotation', angle * Math.PI / 180 );

    var rotation = angle * Math.PI / 180;

    fix_position($(this), rotation);

  });

  $('#lighttable a').bind('vclick', function(event) {
    // Exit if we're not rotating an image
    if ( !imageBeingRotated ) return;

    var img = $(this).attr('href');
    imageRotated = $('#lighttable img').get(img);

    var rotation = Math.round($(imageRotated).data('currentRotation'));

    fix_position($(imageRotated), rotation);

    // Remove the event handler that tracked mouse movements during the rotation
    $(document).unbind( 'vmousemove' );

    // Cancel the image rotation by setting imageBeingRotated back to false.
    // Do this in a short while - after the click event has fired -
    // to prevent the lightbox appearing once the Shift key is released.
    setTimeout( function() { imageBeingRotated = false; }, 10 );
    return false;
  });

  $('#lighttable a').bind('vmousedown', function(event) {
    // Track the image that we're going to rotate
    var img = $(this).attr('href');

    imageBeingRotated = $('#lighttable img').get(img);
    
    // Store the angle of the mouse at the start of the rotation, relative to the image centre
    var imageCentre = getImageCentre( imageBeingRotated );
    var mouseStartXFromCentre = event.pageX - imageCentre[0];
    var mouseStartYFromCentre = event.pageY - imageCentre[1];
    mouseStartAngle = Math.atan2( mouseStartYFromCentre, mouseStartXFromCentre );

    // Store the current rotation angle of the image at the start of the rotation
    imageStartAngle = $(imageBeingRotated).data('currentRotation');

    // Set up an event handler to rotate the image as the mouse is moved
    $('#lighttable a').bind('vmousemove', function(event) {
      //var imageCentre = getImageCentre( imageBeingRotated );
      var mouseXFromCentre = event.pageX - imageCentre[0];
      var mouseYFromCentre = event.pageY - imageCentre[1];
      var mouseAngle = Math.atan2( mouseYFromCentre, mouseXFromCentre );

      // Calculate the new rotation angle for the image
      rotateAngle = mouseAngle - mouseStartAngle + imageStartAngle;

      // Rotate the image to the new angle, and store the new angle
      $(imageBeingRotated).css('transform','rotate(' + rotateAngle + 'rad)');
      $(imageBeingRotated).css('-moz-transform','rotate(' + rotateAngle + 'rad)');
      $(imageBeingRotated).css('-webkit-transform','rotate(' + rotateAngle + 'rad)');
      $(imageBeingRotated).css('-o-transform','rotate(' + rotateAngle + 'rad)');
      $(imageBeingRotated).data('currentRotation', rotateAngle );

      return false;

    });

    return false;
  });

});

// Calculate the centre point of a given image

function getImageCentre( image ) {

  // Rotate the image to 0 radians
  /*$(image).css('transform','rotate(0rad)');
  $(image).css('-moz-transform','rotate(0rad)');
  $(image).css('-webkit-transform','rotate(0rad)');
  $(image).css('-o-transform','rotate(0rad)');*/

  // Measure the image centre
  var imageOffset = $(image).offset();
  var imageCentreX = imageOffset.left + $(image).width() / 2;
  var imageCentreY = imageOffset.top + $(image).height() / 2;

  // Rotate the image back to its previous angle
  var currentRotation = $(image).data('currentRotation');
  $(imageBeingRotated).css('transform','rotate(' + currentRotation + 'rad)');
  $(imageBeingRotated).css('-moz-transform','rotate(' + currentRotation + 'rad)');
  $(imageBeingRotated).css('-webkit-transform','rotate(' + currentRotation + 'rad)');
  $(imageBeingRotated).css('-o-transform','rotate(' + currentRotation + 'rad)');

  // Return the calculated centre coordinates
  return Array( imageCentreX, imageCentreY );
}
</script>

</head>
<body>
  <div id="lighttable">
    <img src="img/img01.png" alt="imagem01" />
    <img src="img/img02.png" alt="imagem02" />
    <img src="img/img03.png" alt="imagem03" />
    <img src="img/img04.png" alt="imagem04" />
    <img src="img/img05.png" alt="imagem05" />
    <div class="centro"></div>
    <a href="0">imagem 1</a>
    <a href="1">imagem 2</a>
    <a href="2">imagem 3</a>
    <a href="3">imagem 4</a>
    <a href="4">imagem 5</a>
  </div>
</body>
</html>