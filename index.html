
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Smooth Rotatable Images with CSS3 and jQuery | Demo | Elated.com</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >

<style type="text/css">

/* The page body */
html, body {
  background: #333;
  overflow: hidden;
  font-family: Helvetica, Arial, sans-serif;
}

/* The light table itself */
#lighttable {
  position: relative;
  width: 800px;
  height: 450px;
  background: #eee url(img/wooden-table.jpg);
  padding: 70px;
  margin: 0 auto;
  border: 20px solid #111;
}

/* Photos on the light table */
#lighttable img {
  border: 2px solid #fff;
  box-shadow: 0 0 1em rgba(0, 0, 0, 0.9);
  -moz-box-shadow: 0 0 1em rgba(0, 0, 0, 0.9);
  -webkit-box-shadow: 0 0 1em rgba(0, 0, 0, 0.9);
  position: absolute;
  left: 99px;
  top: 99px;
}

#lighttable img:hover {
  cursor: pointer;
}

</style>

<script src="js/jquery-2.0.2.min.js"></script>
<script type="text/javascript" src="js/jquery.mobile-1.3.1.min.js"></script>
<link type="text/css" media="screen" rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css" />

<script type="text/javascript">

var rotateAngle = 0;         // To make sure newly-loaded images land on top of images on the table
var imageBeingRotated = false;  // The DOM image currently being rotated (if any)
var mouseStartAngle = false;    // The angle of the mouse relative to the image centre at the start of the rotation
var imageStartAngle = false;    // The rotation angle of the image at the start of the rotation


$(document).ready(function() {

  $('#lighttable img').each( function(index) {

    // Set a random position and angle for this photo
    var left = Math.floor( index * 50 + 200 );
    var top = Math.floor( index * 50 + 20 );
    var angle = 0;
    $(this).css( 'left', left+'px' );
    $(this).css( 'top', top+'px' );
    $(this).css( 'transform', 'rotate(' + angle + 'deg)' );   
    $(this).css( '-moz-transform', 'rotate(' + angle + 'deg)' );   
    $(this).css( '-webkit-transform', 'rotate(' + angle + 'deg)' );
    $(this).css( '-o-transform', 'rotate(' + angle + 'deg)' );
    $(this).data('currentRotation', angle * Math.PI / 180 );


    // Make the photo rotatable
    //$(this).mousedown( startRotate );

  });

  $('#lighttable img').bind('vmouseup', function(event) {
    // Exit if we're not rotating an image
    if ( !imageBeingRotated ) return;

    if(Math.floor(rotateAngle) > 0 && Math.floor(rotateAngle) <= 1){
      alert("1");
    }


    // Remove the event handler that tracked mouse movements during the rotation
    $(document).unbind( 'vmousemove' );
    return false;
  });

  $('#lighttable img').bind('vmousedown', function(event) {
    
    // Track the image that we're going to rotate
    imageBeingRotated = $(this);

    // Store the angle of the mouse at the start of the rotation, relative to the image centre
    var imageCentre = getImageCentre( imageBeingRotated );
    var mouseStartXFromCentre = event.pageX - imageCentre[0];
    var mouseStartYFromCentre = event.pageY - imageCentre[1];
    mouseStartAngle = Math.atan2( mouseStartYFromCentre, mouseStartXFromCentre );

    // Store the current rotation angle of the image at the start of the rotation
    imageStartAngle = $(imageBeingRotated).data('currentRotation');

    // Set up an event handler to rotate the image as the mouse is moved
    $('#lighttable img').bind('vmousemove', function(event) {
      var imageCentre = getImageCentre( imageBeingRotated );
      var mouseXFromCentre = event.pageX - imageCentre[0];
      var mouseYFromCentre = event.pageY - imageCentre[1];
      var mouseAngle = Math.atan2( mouseYFromCentre, mouseXFromCentre );

      // Calculate the new rotation angle for the image
      rotateAngle = mouseAngle - mouseStartAngle + imageStartAngle;

      // Rotate the image to the new angle, and store the new angle
      $(imageBeingRotated).css('transform','rotate(' + rotateAngle + 'rad)');
      $(imageBeingRotated).css('-moz-transform','rotate(' + rotateAngle + 'rad)');
      $(imageBeingRotated).css('-webkit-transform','rotate(' + rotateAngle + 'rad)');
      $(imageBeingRotated).css('-o-transform','rotate(' + rotateAngle + 'rad)');
      $(imageBeingRotated).data('currentRotation', rotateAngle );

      return false;

    });
    return false;
  });

});

// Calculate the centre point of a given image

function getImageCentre( image ) {

  // Rotate the image to 0 radians
  $(image).css('transform','rotate(0rad)');
  $(image).css('-moz-transform','rotate(0rad)');
  $(image).css('-webkit-transform','rotate(0rad)');
  $(image).css('-o-transform','rotate(0rad)');

  // Measure the image centre
  var imageOffset = $(image).offset();
  var imageCentreX = imageOffset.left + $(image).width() / 2;
  var imageCentreY = imageOffset.top + $(image).height() / 2;

  // Rotate the image back to its previous angle
  var currentRotation = $(image).data('currentRotation');
  $(imageBeingRotated).css('transform','rotate(' + currentRotation + 'rad)');
  $(imageBeingRotated).css('-moz-transform','rotate(' + currentRotation + 'rad)');
  $(imageBeingRotated).css('-webkit-transform','rotate(' + currentRotation + 'rad)');
  $(imageBeingRotated).css('-o-transform','rotate(' + currentRotation + 'rad)');

  // Return the calculated centre coordinates
  return Array( imageCentreX, imageCentreY );
}
</script>

</head>
<body>

  <div id="lighttable">
    <img src="img/img02.png" alt="Double Propellors" style="z-index:1 !important; border-radius:250px;" />
    <img src="img/img01.png" alt="Bird Marking" style="z-index:2 !important; border-radius:200px;" />
    <img src="img/img03.png" alt="Moody Listener Satellite Dish" style="z-index:3 !important; border-radius:150px;" />
  </div>

</body>
</html>